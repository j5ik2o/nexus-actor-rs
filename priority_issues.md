# nexus-actor-rs 優先度の高い課題

更新日: 2025/01/27

## 1. コードベースの構造的複雑さの解消（最優先）

### 現状の問題
- coreモジュールの構造が複雑で、モジュール間の依存関係が不明確
- `actor/`ディレクトリ内に多層のサブディレクトリが存在し、ナビゲーションが困難
- 循環依存の可能性がある

### 影響
- 新機能追加やバグ修正が困難
- 開発効率の低下
- 新規開発者のオンボーディングに時間がかかる

### 対応計画
- `refactoring_todos.md`に記載された8フェーズのリファクタリング計画を実行
- 現在の進捗: テスト構造の改善を実施中（最近のコミット参照）
- 次のステップ: フェーズ1（依存関係の可視化）とフェーズ2（テスト環境の整備）

## 2. テストコードの整理と分離（高優先度）

### 現状の問題
- テストコードが実装コードと混在（`*_test.rs`ファイル）
- テストファイルの配置が不統一
- 統合テストと単体テストの区別が不明確

### 影響
- テストの保守性低下
- 新規テスト追加時の混乱
- テストカバレッジの把握が困難

### 対応計画
- 単体テストを`#[cfg(test)]`モジュールに移行
- 統合テストを`core/tests/`ディレクトリに移行
- テストディレクトリ構造の標準化

### 最近の進捗
- コミット f23b279: テストモジュールの再編成
- コミット 5481478: mailboxインポートの統合とテスト構造の再編成

## 3. リモートモジュールの技術的負債（中優先度）

### 現状の問題
以下のファイルにTODO/FIXMEコメントが存在：
- `remote/src/endpoint_manager.rs`: エラーハンドリングの改善が必要
- `remote/src/endpoint_writer.rs`: パフォーマンス最適化の余地
- `remote/src/endpoint_reader.rs`: エラー処理とリトライロジック
- `remote/src/cluster/messages.rs`: 未実装の機能

### 影響
- 分散システムの信頼性低下
- エラー発生時の適切なリカバリー不足
- パフォーマンスのボトルネック

### 対応計画
1. 各TODOコメントの内容を確認し、優先順位付け
2. エラーハンドリングの統一的な方針を策定
3. パフォーマンステストの実施と最適化

## 4. 並行処理の最適化（中優先度）

### 現状の問題
- 不適切な同期プリミティブの使用（Mutex vs RwLock）
- 過度な排他制御によるパフォーマンス低下

### 影響
- 高負荷時のスループット制限
- レスポンスタイムの増加
- スケーラビリティの制限

### 対応計画
- 適切な同期プリミティブの選択（読み取り多数の場合はRwLock）
- ロックの粒度の最適化
- lock-freeデータ構造の検討

### 最近の進捗
- コミット 8ae8d6a: MutexからRwLockへの移行でコンカレンシー改善

## 5. ドキュメントとAPIの整理（低優先度だが重要）

### 現状の問題
- 新しいモジュール構造に対応したドキュメント不足
- 公開APIの境界が不明確
- 使用例やベストプラクティスの不足

### 影響
- 新規開発者のオンボーディング困難
- APIの誤用によるバグ
- ライブラリ採用の障壁

### 対応計画
1. リファクタリング完了後に実施
2. `core/src/api.rs`で公開APIを整理
3. 各モジュールにモジュールレベルのドキュメント追加
4. 実践的な使用例の充実

## 推奨される実施順序

1. **即座に対応すべき項目**
   - フェーズ1: 依存関係の可視化と分析
   - フェーズ2: テスト環境の整備とカバレッジ測定

2. **短期的に対応すべき項目**（1-2週間）
   - テストコードの分離と整理
   - リモートモジュールの重要なTODO対応

3. **中期的に対応すべき項目**（1ヶ月）
   - coreモジュールの段階的リファクタリング（フェーズ3-6）
   - 並行処理の最適化とパフォーマンステスト

4. **長期的に対応すべき項目**（2-3ヶ月）
   - 公開APIの整理（フェーズ7）
   - 包括的なドキュメント更新
   - クリーンアップと最適化（フェーズ8）

## 成功指標

- テストカバレッジ: 80%以上
- ビルド時間: 現在より20%短縮
- 新規開発者のオンボーディング時間: 1週間以内
- パフォーマンス: 現在より30%向上（ベンチマーク基準）